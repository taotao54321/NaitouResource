+++
title = "RAM マップ"
date = 2022-01-21
+++

## 概要

|アドレス|型|内容|
|--|--|--|
|`$00-$06`||雑用|
|`$07`|`u8[11]`|盤面の各筋に COM の歩があるかどうか (0:false, 0xFF:true)|
|`$12`|`u8`|雑用 (候補手生成時の座標x管理用)|
|`$13-$14`||(未使用)|
|`$15`|`u8`|表示用手数 一、十の位 (`0..=99`)|
|`$16`|`u8`|表示用手数 百の位 (10 以上になると表示が化ける)|
|`$17-$1E`||雑用|
|`$1F-$21`|`u8[3]`|プレイヤー玉周辺の 3 つの筋にプレイヤーの歩があるかどうか (0:false, 0xFF:true)|
|`$22-$29`||(未使用)|
|`$2A-$2B`||雑用|
|`$2C-$3B`|`u8[16]`|定跡分岐 i 個目を処理したときの手数を記録するバッファ|
|`$3C-$53`|`u8[24]`|定跡手順 i 個目を処理したときの手数を記録するバッファ|
|`$54`|`ptr`|現在の戦型に対応する定跡分岐データへのポインタ|
|`$56`|`ptr`|現在の戦型に対応する定跡手順データへのポインタ|
|`$58-$5B`||雑用|
|`$5C`||(未使用)|
|`$5D-$5E`||雑用|
|`$5F`|`u8`|候補手の移動元の駒 (駒打ちの場合は打つ駒)|
|`$60-$67`||雑用|
|`$68`|`u8`|駒損マスの評価における取り返しフラグ (0:false, 1:true)|
|`$69-$6F`||(未使用)|
|`$70-$71`||雑用|
|`$72`||(未使用)|
|`$73`|`u8`|時間制限 (0:なし, 1:あり(秒読み突入前), 2:あり(秒読み突入後))|
|`$74`|`u8`|持ち時間管理用フレームカウンタ (60 に達すると 1 秒減る)|
|`$75`|`u8`|持ち時間 分|
|`$76`|`u8`|持ち時間 秒|
|`$77`|`u8`|プレイヤーの手番かどうか (0:false, 1:true)|
|`$78`|`u8`|NMI ハンドラに対する持ち時間描画要求フラグ (0:false, 1:true)|
|`$79-$7C`||雑用|
|`$7D-$7E`||(未使用)|
|`$7F`||未使用だが、[スタックポインタ設定バグ](@/bug/index.md#stack-pointer)で参照される|
|`$80`|`u8`|デモ中かどうか (0:false, 1:true)|
|`$81`|`u8`|タイマーB(フレーム単位)の上位 Byte|
|`$82`|`ptr`|デモ入力へのポインタ|
|`$84`|`u8`|待ったのために B を押した回数|
|`$85`|`u8`|待った不可フラグ (0:false, 1:true)|
|`$86`|`u8`|タイマーA(フレーム単位)|
|`$87`||雑用|
|`$88-$8F`||(未使用)|
|`$90`|`u8`|APU `$4015` 設定用|
|`$91-$94`||雑用 (サウンド関連)|
|`$95`|`ptr`|矩形波1サウンドデータへのポインタ|
|`$97`|`ptr`|三角波サウンドデータへのポインタ|
|`$99`|`u16le`|サウンド周波数タイマー値|
|`$9B`|`u8`|APU `$4000` 設定用|
|`$9C`|`u8`|APU `$4001` 設定用|
|`$9D`|`u8`|APU `$4002` 設定用|
|`$9E`|`u8`|APU `$4003` 設定用|
|`$9F-$A0`||(未使用)|
|`$A1`|`u8`|APU `$400A` 設定用|
|`$A2`|`u8`|APU `$400B` 設定用|
|`$A3`|`u8`|矩形波1 オクターブ数|
|`$A4`|`u8`|三角波 オクターブ数|
|`$A5`|`u8`|サウンド length counter index の最上位 bit (`0..=1`)|
|`$A6`|`u8`|サウンドデータから読み取った Byte|
|`$A7-$A9`||雑用 (サウンド関連)|
|`$AA-$BC`||(未使用)|
|`$BD-$BF`||雑用|
|`$C0-$CF`||(未使用)|
|`$D0-$D3`||雑用|
|`$D4-$D5`||(未使用)|
|`$D6`|`u8`|カーソル座標x|
|`$D7`|`u8`|カーソル座標y|
|`$D8-$D9`||雑用|
|`$DA`|`u8`|ゲームへの入力 (ABSTUDLR)|
|`$DB`|`u8`|生のコントローラー入力 (ABSTUDLR)|
|`$DC-$DE`||雑用|
|`$DF`|`u8`|プレイヤーが駒を掴んでいるかどうか (0:false, 1:true)|
|`$E0-$E3`||雑用|
|`$E4-$E6`||(未使用)|
|`$E7-$EC`||雑用|
|`$ED`|`u8`|タイマーB(フレーム単位)の下位 Byte|
|`$EE-$EF`||雑用|
|`$F0`|`u8`|PPU `$2000` 設定用|
|`$F1`|`u8`|PPU `$2001` 設定用|
|`$F2`|`u8`|PPU スクロールx (`$2005`) 設定用|
|`$F3`|`u8`|PPU スクロールy (`$2005`) 設定用|
|`$F4-$F9`||(未使用)|
|`$FA-$FD`||雑用|
|`$FE`|`u8`|[手合割](#handicap)|
|`$FF`|`u8`|NMI タスクID (`0..=4`)|
|`$0100-$017F`||スタック領域|
|`$0180-$01F8`|`u8[121]`|プレイヤー側の各マスに対する attacker (存在しない場合 99)|
|`$01F9-$0271`|`u8[121]`|COM側の各マスに対する attacker (存在しない場合 99)|
|`$0272`|`u8`|候補手の最大駒得価値 (駒得マスがない場合 0)|
|`$0273`|`u8`|候補手の最大駒得マス (駒得マスがない場合 99)|
|`$0274`|`u8`|候補手の最大駒損価値 (駒損マスがない場合 0)
|`$0275`|`u8`|候補手の最大駒損マス (駒損マスがない場合 99)|
|`$0276`|`u8`|候補手の移動先|
|`$0277`|`u8`|候補手の移動元|
|`$0278`|`u8`|候補手で捕獲する駒の価値|
|`$0279`|`u8`|候補手が成りかどうか (0:false, 1:true)|
|`$027A`|`u8`|*ルート局面での* プレイヤー玉位置|
|`$027B`|`u8`|*ルート局面での* COM玉位置|
|`$027C`|`u8`|候補手が駒捨てかどうか (0:false, 1:true)|
|`$027D`|`u8`|*ルート局面での* プレイヤー玉座標y|
|`$027E`|`u8`|*ルート局面での* プレイヤー玉座標x|
|`$027F`||雑用|
|`$0280`|`u8`|ルート局面の最大駒得価値 (駒得マスがない場合 0)|
|`$0281`||(未使用)|
|`$0282`|`u8`|ルート局面の最大駒損価値|
|`$0283`||(未使用)|
|`$0284`|`u8`|現在の最善手の移動先 (思考開始時に初期化されない)|
|`$0285`|`u8`|現在の最善手の移動元 (思考開始時に初期化されない)|
|`$0286`|`u8`|現在の最善手の最大駒得価値 (思考開始時の初期値 0)|
|`$0287`|`u8`|現在の最善手の最大駒得マス (思考開始時の初期値 99)|
|`$0288`|`u8`|現在の最善手の最大駒損価値 (思考開始時の初期値 99)|
|`$0289`|`u8`|現在の最善手の最大駒損マス (思考開始時の初期値 99)|
|`$028A`|`u8`|現在の最善手の捕獲する駒の価値 (思考開始時の初期値 0)|
|`$028B`||(未使用)|
|`$028C`|`u8`|現在の最善手が成りかどうか (0:false, 1:true) (思考開始時の初期値 0)|
|`$028D`||(未使用。常に 0)|
|`$028E`|`u8`|進行度 (`0..=3`)|
|`$028F-$0292`||(未使用)|
|`$0293`|`u8`|候補手を指した局面におけるCOM側の成駒の個数|
|`$0294`|`u8`|候補手の移動先から *ルート局面での* プレイヤー玉位置への距離|
|`$0295`|`u8`|候補手を指した局面における、*ルート局面での* COM玉位置から距離 2 以内へのCOM利きの総和|
|`$0296`|`u8`|候補手を指した局面における、*ルート局面での* COM玉位置から距離 2 以内へのプレイヤー利きの総和|
|`$0297`|`u8`|候補手を指した局面におけるCOM側の離れ駒の個数|
|`$0298`|`u8`|候補手の移動元(駒打ちの場合は移動先)から *ルート局面での* COM玉位置への距離|
|`$0299`|`u8`|候補手を指した局面における、*ルート局面での* プレイヤー玉位置から距離 2 以内へのCOM利きの総和|
|`$029A`|`u8`|現在の最善手を指した局面におけるCOM側の成駒の個数 (思考開始時の初期値 0)|
|`$029B`|`u8`|現在の最善手の移動先から *ルート局面での* プレイヤー玉位置への距離 (思考開始時の初期値 99)|
|`$029C`|`u8`|現在の最善手を指した局面における、*ルート局面での* COM玉位置から距離 2 以内へのCOM利きの総和 (思考開始時の初期値 0)|
|`$029D`|`u8`|現在の最善手を指した局面における、*ルート局面での* COM玉位置から距離 2 以内へのプレイヤー利きの総和 (思考開始時の初期値 99)|
|`$029E`|`u8`|現在の最善手を指した局面におけるCOM側の離れ駒の個数 (思考開始時の初期値 99)|
|`$029F`|`u8`|現在の最善手の移動元(駒打ちの場合は移動先)から *ルート局面での* COM玉位置への距離 (思考開始時の初期値 0)|
|`$02A0`|`u8`|現在の最善手を指した局面における、*ルート局面での* プレイヤー玉位置から距離 2 以内へのCOM利きの総和 (思考開始時の初期値 0)|
|`$02A1`||雑用|
|`$02A2`|`u8`|*ルート局面での* COM玉座標y|
|`$02A3`|`u8`|*ルート局面での* COM玉座標x|
|`$02A4`|`u8`|候補手を指した局面における総駒得価値|
|`$02A5`||(未使用。ルート局面の総駒得価値)|
|`$02A6`|`u8`|最善手を指した局面における総駒得価値 (思考開始時の初期値 0)|
|`$02A7-$02A8`||雑用|
|`$02A9-$0321`|`u8[121]`|盤面A プレイヤー側|
|`$0322-$039A`|`u8[121]`|盤面A COM側|
|`$039B-$03A1`|`u8[7]`|手駒A プレイヤー側|
|`$03A2-$03A8`|`u8[7]`|手駒A COM側|
|`$03A9-$0421`|`u8[121]`|盤面B プレイヤー側|
|`$0422-$049A`|`u8[121]`|各マスの利き数 プレイヤー側|
|`$049B-$0513`|`u8[121]`|盤面B COM側|
|`$0514-$058C`|`u8[121]`|各マスの利き数 COM側|
|`$058D-$0593`|`u8[7]`|手駒B プレイヤー側|
|`$0594-$059A`|`u8[7]`|手駒B COM側|
|`$059B`|`u8`|プレイヤーの指し手の移動先座標x|
|`$059C`|`u8`|プレイヤーの指し手の移動元座標x|
|`$059D`|`u8`|プレイヤーの指し手の座標x差分|
|`$059E`|`u8`|プレイヤーの指し手の移動先座標y|
|`$059F`|`u8`|プレイヤーの指し手の移動元座標y|
|`$05A0`|`u8`|プレイヤーの指し手の座標y差分|
|`$05A1`|`u8`|プレイヤーの指し手の移動先|
|`$05A2`|`u8`|プレイヤーの指し手の移動元|
|`$05A3`||(未使用。write-only)|
|`$05A4-$05B3`||雑用 (近接駒の利きデータがロードされる)|
|`$05B4`|`u8`|指し手が違法であるか、または却下されたことを表すフラグ (0:false, 1:true)|
|`$05B5`|`u8`|COMの指し手の移動先座標x|
|`$05B6`|`u8`|COMの指し手の移動元座標x|
|`$05B7`|`u8`|COMの指し手の座標x差分|
|`$05B8`|`u8`|COMの指し手の移動先座標y|
|`$05B9`|`u8`|COMの指し手の移動元座標y|
|`$05BA`|`u8`|COMの指し手の座標y差分|
|`$05BB`|`u8`|COMの指し手の移動先|
|`$05BC`|`u8`|COMの指し手の移動元|
|`$05BD`|`u8`|[手合割](#handicap) コピー|
|`$05BE`|`u8`|[戦型](#formation)|
|`$05BF`|`u8`|プレイヤーの指し手が成りかどうか (0:false, 1:true)|
|`$05C0`|`u8`|COMの指し手が成りかどうか (0:false, 1:true)|
|`$05C1`|`u8`|進行度管理用手数 (0 始まり。上限 100)|
|`$05C2-$05C7`||雑用|
|`$05C8`|`u8`|サブ進行度 (`0..=5`)|
|`$05C9-$05D9`||雑用|
|`$05DA`||(未使用。write-only)|
|`$05DB`||(未使用)|
|`$05DC`|`u8`|プレイヤー玉の詰み判定における不詰フラグ (0:false, 1:true)|
|`$05DD`|`u8`|プレイヤー玉の詰みフラグ (0:false, 1:true)|
|`$05DE`||(未使用。プレイヤー側の駒捨てに関係するが、実際は思考結果に影響しない)|
|`$05DF`|`u8`|候補手を指した局面におけるプレイヤー側の垂れ歩/垂れ香存在フラグ (0:false, 1:true)|
|`$05E0`|`u8`|候補手を指した局面における総駒損価値|
|`$05E1`||(未使用。ルート局面の総駒損価値)|
|`$05E2`|`u8`|現在の最善手を指した局面における総駒損価値 (思考開始時の初期値 99)|
|`$05E3`||(未使用。候補手が大駒の成りかどうかのフラグ)|
|`$05E4`|`u8`|ルート局面のCOM側 power (`8*(持飛+持角+成駒) + 4*(持金+持銀) + 2*(持桂+持香) + 1*(持歩) + (手数補正)`)|
|`$05E5`|`u8`|候補手を指した局面における、*ルート局面での* COM玉位置からちょうど距離 1 で、`(プレイヤー利き) >= (COM利き)` なるマスの個数|
|`$05E6`||(未使用。最善手を指した局面における、*ルート局面での* COM玉位置からちょうど距離 1 で、`(プレイヤー利き) >= (COM利き)` なるマスの個数)|
|`$05E7`|`u8`|ルート局面のプレイヤー側 power (`8*(持飛+持角+成駒) + 4*(持金+持銀) + 2*(持桂+持香) + 1*(持歩) + (手数補正)`)|
|`$05E8`|`u8`|候補手を指した局面におけるプレイヤー側の成駒の個数|
|`$05E9`||(未使用。最善手を指した局面におけるプレイヤー側の成駒の個数)|
|`$05EA`|`u8`|ルート局面のCOM側の `持飛+持角+成駒`|
|`$05EB`|`u8`|候補手を指した局面における、*ルート局面での* COM玉位置からちょうど距離 1 へのプレイヤー利きの総和|
|`$05EC-$05FF`||(未使用)|
|`$0600-$061F`|`u8[32]`|パレット|
|`$0620-$06FF`||動的なBGデータ用バッファ|
|`$0700-$07FF`|`Sprite[64]`|スプライトバッファ|

## 手合割 {#handicap}

| 値 | 内容               |
| -- | --                 |
| 1  | プレイヤー先手     |
| 2  | プレイヤー飛車落ち |
| 3  | プレイヤー二枚落ち |
| 4  | COM先手            |
| 5  | COM飛車落ち        |
| 6  | COM二枚落ち        |

## 戦型 {#formation}

| 値 | 内容                  |
| -- | --                    |
| 0  | 中飛車                |
| 1  | 四間飛車              |
| 2  | (無効値)              |
| 3  | 角換わり              |
| 4  | 筋違い角              |
| 5  | (無効値)              |
| 6  | プレイヤー飛車落ち    |
| 7  | プレイヤー二枚落ち    |
| 8  | COM飛車落ち           |
| 9  | COM二枚落ち           |
| 99 | なし (定跡を抜けた後) |
